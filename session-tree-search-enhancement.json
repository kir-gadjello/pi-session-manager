{
  "taskSetName": "session-tree-search-enhancement",
  "projectName": "Session Viewer 搜索功能优化",
  "outputDir": "./task",
  "goals": [
    {
      "metric": "会话内搜索 CPU 使用率",
      "before": "高 (每次搜索全量处理)",
      "target": "极低 (仅树节点过滤)",
      "improvement": "90%+"
    },
    {
      "metric": "内存占用",
      "before": "高 (多重缓存)",
      "target": "低 (无额外缓存)",
      "improvement": "70%+"
    },
    {
      "metric": "代码复杂度",
      "before": "高 (多组件协调)",
      "target": "低 (单一入口)",
      "improvement": "60%+"
    }
  ],
  "tasks": [
    {
      "id": "001",
      "title": "分析当前搜索功能架构和性能瓶颈",
      "priority": "High",
      "estimated": "2h",
      "description": "深入分析当前 Cmd+F 会话内搜索的实现细节，识别性能瓶颈和冗余代码",
      "steps": [
        "审查 SessionViewer.tsx 中的搜索相关代码",
        "分析 UserMessage.tsx 和 AssistantMessage.tsx 的高亮实现",
        "检查 utils/search.ts 中的 highlightSearchInHTML 函数",
        "评估虚拟滚动与搜索高亮的冲突点",
        "记录当前性能数据（CPU、内存、渲染时间）",
        "创建详细的性能问题分析报告"
      ],
      "dependencies": [],
      "acceptance": [
        "完成性能问题分析报告",
        "识别出所有需要删除的文件和代码",
        "确定 SessionTree 增强的具体需求"
      ]
    },
    {
      "id": "002",
      "title": "设计 SessionTree 搜索增强功能",
      "priority": "High",
      "estimated": "3h",
      "description": "设计新的 SessionTree 搜索功能，包括 UI/UX 和技术实现方案",
      "steps": [
        "设计 SessionTree 顶部搜索框的 UI 组件",
        "设计搜索结果导航功能（上一个/下一个）",
        "设计搜索结果在树节点中的视觉指示",
        "设计快捷键集成方案（Cmd/Ctrl + F 聚焦搜索框）",
        "创建详细的技术实现文档",
        "设计用户迁移方案和回退机制"
      ],
      "dependencies": ["001"],
      "acceptance": [
        "完成 SessionTree 搜索功能设计文档",
        "UI 组件设计稿完成",
        "技术实现方案获得确认"
      ]
    },
    {
      "id": "003",
      "title": "实现 SessionTree 搜索增强功能",
      "priority": "High",
      "estimated": "4h",
      "description": "实现 SessionTree 搜索增强功能，包括搜索框、结果导航和视觉指示",
      "steps": [
        "创建 SessionTreeSearch.tsx 组件",
        "实现搜索框输入和防抖逻辑",
        "实现搜索结果计算和状态管理",
        "实现搜索结果导航（上一个/下一个）",
        "在 SessionTree 节点中添加搜索结果视觉指示",
        "集成快捷键支持（Cmd/Ctrl + F）",
        "编写单元测试"
      ],
      "dependencies": ["002"],
      "acceptance": [
        "SessionTree 搜索功能完整实现",
        "搜索结果正确显示和导航",
        "快捷键正常工作",
        "单元测试通过"
      ]
    },
    {
      "id": "004",
      "title": "移除 Cmd+F 会话内搜索功能",
      "priority": "High",
      "estimated": "3h",
      "description": "安全地移除现有的 Cmd+F 会话内搜索功能，包括所有相关组件、样式和逻辑",
      "steps": [
        "删除 SearchBar.tsx 组件",
        "移除 SessionViewer.tsx 中的搜索状态管理和快捷键监听",
        "移除 UserMessage.tsx 和 AssistantMessage.tsx 中的 searchQuery 参数",
        "删除 utils/search.ts 中的 highlightSearchInHTML 函数",
        "清理相关的 CSS 样式",
        "更新翻译文件，移除会话内搜索相关翻译",
        "验证其他功能不受影响"
      ],
      "dependencies": ["003"],
      "acceptance": [
        "所有 Cmd+F 相关代码已完全移除",
        "应用功能正常，无编译错误",
        "SessionTree 搜索功能正常工作"
      ]
    },
    {
      "id": "005",
      "title": "集成和测试 SessionTree 搜索功能",
      "priority": "Medium",
      "estimated": "3h",
      "description": "将 SessionTree 搜索功能集成到主应用中，并进行全面测试",
      "steps": [
        "在 SessionViewer.tsx 中集成 SessionTreeSearch 组件",
        "测试搜索功能在不同大小会话中的性能表现",
        "测试快捷键集成（Cmd/Ctrl + F）",
        "测试搜索结果导航功能",
        "测试大型会话（1000+ 消息）的性能",
        "验证与现有功能的兼容性",
        "修复发现的问题"
      ],
      "dependencies": ["004"],
      "acceptance": [
        "SessionTree 搜索功能在所有场景下正常工作",
        "性能指标达到目标（CPU 降低 90%+）",
        "用户体验流畅，无明显延迟"
      ]
    },
    {
      "id": "006",
      "title": "更新文档和用户指南",
      "priority": "Medium",
      "estimated": "2h",
      "description": "更新相关文档，包括用户指南、开发文档和迁移说明",
      "steps": [
        "更新 README.md 中的搜索功能说明",
        "创建用户迁移指南，说明新搜索功能的使用方法",
        "更新开发文档，说明新的搜索架构",
        "更新键盘快捷键文档",
        "创建性能优化报告"
      ],
      "dependencies": ["005"],
      "acceptance": [
        "所有相关文档已更新",
        "用户迁移指南清晰易懂",
        "性能优化报告完成"
      ]
    },
    {
      "id": "007",
      "title": "最终验证和发布准备",
      "priority": "High",
      "estimated": "2h",
      "description": "进行最终的全面验证，确保所有功能正常，并准备发布",
      "steps": [
        "进行全面的功能测试",
        "进行性能基准测试，验证优化效果",
        "验证回退机制（如果需要）",
        "清理临时代码和调试日志",
        "更新版本号和变更日志",
        "准备发布说明"
      ],
      "dependencies": ["006"],
      "acceptance": [
        "所有功能测试通过",
        "性能指标达到预期目标",
        "发布准备完成"
      ]
    }
  ]
}