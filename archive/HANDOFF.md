# Handoff - Pi Session Manager

## é¡¹ç›®çŠ¶æ€

**é¡¹ç›®**: Pi Session Manager  
**ç‰ˆæœ¬**: 0.1.0  
**çŠ¶æ€**: Phase 2 å®Œæˆ - é«˜çº§ä»ªè¡¨ç›˜å·²å®ç°  
**æœ€åæ›´æ–°**: 2026-01-30

## å·²å®ŒæˆåŠŸèƒ½

### Phase 1 - MVP
- âœ… ä¼šè¯åˆ—è¡¨æ‰«æ
- âœ… ä¼šè¯å…ƒæ•°æ®æå–
- âœ… ä¼šè¯æŸ¥çœ‹å™¨
- âœ… å…¨æ–‡æœç´¢
- âœ… æš—é»‘æ¨¡å¼ UI

### Phase 2 - å·²å®ç°
- âœ… åˆ é™¤ä¼šè¯
- âœ… å¯¼å‡ºä¼šè¯ (HTML/MD/JSON)
- âœ… é‡å‘½åä¼šè¯
- âœ… **é«˜çº§ç»Ÿè®¡ä»ªè¡¨ç›˜** (2026-01-30 æ–°å¢)
  - âœ… 6ä¸ªæ ‡ç­¾é¡µï¼šOverviewã€Activityã€Projectsã€Timeã€Tokensã€Productivityã€Achievements
  - âœ… å…¨å¹´æ´»åŠ¨çƒ­åŠ›å›¾ï¼ˆGitHubé£æ ¼ï¼‰
  - âœ… Token ç”¨é‡ç»Ÿè®¡ï¼ˆæŒ‰æ¨¡å‹åˆ†ç»„ï¼‰
  - âœ… çœŸå®çš„ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯ç»Ÿè®¡
  - âœ… æ—¶é—´åˆ†å¸ƒåˆ†æï¼ˆå°æ—¶/æ—¥/å‘¨ï¼‰
  - âœ… æˆæœ¬è¿½è¸ª
  - âœ… æˆå°±ç³»ç»Ÿï¼ˆ8ä¸ªå¾½ç« ï¼‰
  - âœ… ç”Ÿäº§åŠ›æŒ‡æ ‡ï¼ˆè¿ç»­å¤©æ•°è¿½è¸ªï¼‰
- âœ… é”®ç›˜å¿«æ·é”®
- âœ… æœç´¢ç»“æœåŒ¹é…è®¡æ•°
- âœ… ç›®å½•è§†å›¾å’Œåˆ—è¡¨è§†å›¾åˆ‡æ¢

## ä»ªè¡¨ç›˜ç»„ä»¶

### æ ¸å¿ƒç»„ä»¶ (`src/components/dashboard/`)
1. `StatCard.tsx` - ç»Ÿè®¡å¡ç‰‡ï¼Œå¸¦è¶‹åŠ¿æŒ‡ç¤ºå™¨
2. `ActivityHeatmap.tsx` - å…¨å¹´æ´»åŠ¨çƒ­åŠ›å›¾
3. `MessageDistribution.tsx` - ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯åˆ†å¸ƒ
4. `ProjectsChart.tsx` - é¡¹ç›®ä¼šè¯åˆ†å¸ƒ
5. `TimeDistribution.tsx` - æ—¶é—´åˆ†å¸ƒï¼ˆå°æ—¶/æ—¥/å‘¨ï¼‰
6. `ActivityTrend.tsx` - æ´»åŠ¨è¶‹åŠ¿å›¾
7. `RecentSessions.tsx` - æœ€è¿‘ä¼šè¯åˆ—è¡¨
8. `TopModelsChart.tsx` - æ¨¡å‹ä½¿ç”¨æ’è¡Œ
9. `ProductivityMetrics.tsx` - ç”Ÿäº§åŠ›æŒ‡æ ‡
10. `SessionLengthChart.tsx` - ä¼šè¯é•¿åº¦åˆ†å¸ƒ
11. `WeeklyComparison.tsx` - å‘¨å¯¹æ¯”åˆ†æ
12. `TokenStats.tsx` - Token ç”¨é‡ç»Ÿè®¡
13. `Achievements.tsx` - æˆå°±ç³»ç»Ÿ

### åç«¯ç»Ÿè®¡ (`src-tauri/src/`)
1. `stats.rs` - ç»Ÿè®¡è®¡ç®—
   - è§£æä¼šè¯æ–‡ä»¶è·å–çœŸå®æ•°æ®
   - è®¡ç®—ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯æ•°é‡
   - æå–æ¨¡å‹ä¿¡æ¯å’Œ token ç”¨é‡
   - ç”Ÿæˆçƒ­åŠ›å›¾æ•°æ®
   - è®¡ç®—æˆæœ¬
2. `session_parser.rs` - ä¼šè¯æ–‡ä»¶è§£æå™¨
   - è§£æ JSONL æ ¼å¼
   - æå–æ¶ˆæ¯è§’è‰²ç»Ÿè®¡
   - æå– token ä½¿ç”¨æƒ…å†µ
   - æå–æ¨¡å‹åˆ—è¡¨

## ç»Ÿè®¡åŠŸèƒ½è¯¦è§£

### 1. æ¶ˆæ¯ç»Ÿè®¡
- **ç”¨æˆ·æ¶ˆæ¯**: ä»å®é™…ä¼šè¯ä¸­ç»Ÿè®¡ `role="user"` çš„æ¶ˆæ¯
- **åŠ©æ‰‹æ¶ˆæ¯**: ä»å®é™…ä¼šè¯ä¸­ç»Ÿè®¡ `role="assistant"` çš„æ¶ˆæ¯
- **å‡†ç¡®åˆ†å¸ƒ**: ä¸å†ä½¿ç”¨ 50%/50% å ä½ç¬¦

### 2. Token ç»Ÿè®¡
- **Input tokens**: å‘é€ç»™æ¨¡å‹çš„è¾“å…¥ token
- **Output tokens**: æ¨¡å‹ç”Ÿæˆçš„è¾“å‡º token
- **Cache read**: ä»ç¼“å­˜è¯»å–çš„ token
- **Cache write**: å†™å…¥ç¼“å­˜çš„ token
- **æˆæœ¬**: åŸºäº token æ•°é‡çš„ä¼°ç®—
- **æŒ‰æ¨¡å‹åˆ†ç»„**: æ¯ä¸ªæ¨¡å‹çš„ç‹¬ç«‹ç»Ÿè®¡

### 3. æ—¶é—´åˆ†æ
- **çƒ­åŠ›å›¾**: 365å¤©æ´»åŠ¨å¯è§†åŒ–
- **å°æ—¶åˆ†å¸ƒ**: 24å°æ—¶æ´»åŠ¨æ¨¡å¼
- **å‘¨åˆ†å¸ƒ**: æ˜ŸæœŸæ´»åŠ¨æ¨¡å¼
- **å‘¨å¯¹æ¯”**: æœ¬å‘¨ vs ä¸Šå‘¨å¯¹æ¯”

### 4. æˆå°±ç³»ç»Ÿ
- ğŸŒŸ **First Steps**: å®Œæˆç¬¬1ä¸ªä¼šè¯
- ğŸ† **Getting Started**: å®Œæˆ10ä¸ªä¼šè¯
- ğŸ–ï¸ **Dedicated Learner**: å®Œæˆ50ä¸ªä¼šè¯
- ğŸ’¯ **Century Club**: å®Œæˆ100ä¸ªä¼šè¯
- ğŸ”¥ **Week Warrior**: 7å¤©è¿ç»­æ´»åŠ¨
- âš¡ **Monthly Master**: 30å¤©è¿ç»­æ´»åŠ¨
- ğŸ“Š **Message Master**: å‘é€1000+æ¶ˆæ¯
- âœ… **Consistent Coder**: æ´»è·ƒ30+å¤©

## å½“å‰çŠ¶æ€

### å·²ä¿®å¤
1. âœ… SessionViewer ç©ºç™½ body é—®é¢˜
2. âœ… æœç´¢åŠŸèƒ½æ— æ³•ä½¿ç”¨
3. âœ… ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯è¯†åˆ«é”™è¯¯ï¼ˆ50%/50%å ä½ç¬¦ï¼‰
4. âœ… æ¨¡å‹ token ç”¨é‡è¯†åˆ«é”™è¯¯
5. âœ… ç»Ÿè®¡æ•°æ®ä¸å‡†ç¡®é—®é¢˜

### æ— å·²çŸ¥ä¸¥é‡é—®é¢˜

## æŠ€æœ¯æ ˆ

### åç«¯ (Rust)
- Tauri 2.1
- serde, chrono, regex, dirs
- tauri-plugin-dialog
- tantivy (å·²æ·»åŠ ï¼Œå¾…å®Œæ•´å®ç°)

### å‰ç«¯ (TypeScript/React)
- React 18
- @tauri-apps/api
- @tauri-apps/plugin-dialog
- date-fns, lucide-react
- @tanstack/react-virtual
- recharts (å›¾è¡¨åº“)

## é¡¹ç›®ç»“æ„

```
pi-session-manager/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ SessionList.tsx
â”‚   â”‚   â”œâ”€â”€ SessionViewer.tsx
â”‚   â”‚   â”œâ”€â”€ SearchPanel.tsx
â”‚   â”‚   â”œâ”€â”€ ExportDialog.tsx
â”‚   â”‚   â”œâ”€â”€ RenameDialog.tsx
â”‚   â”‚   â”œâ”€â”€ StatsPanel.tsx
â”‚   â”‚   â”œâ”€â”€ TokenCallList.tsx
â”‚   â”‚   â”œâ”€â”€ ExpandableOutput.tsx
â”‚   â”‚   â”œâ”€â”€ BashExecution.tsx
â”‚   â”‚   â”œâ”€â”€ ReadExecution.tsx
â”‚   â”‚   â”œâ”€â”€ WriteExecution.tsx
â”‚   â”‚   â”œâ”€â”€ EditExecution.tsx
â”‚   â”‚   â”œâ”€â”€ GenericToolCall.tsx
â”‚   â”‚   â”œâ”€â”€ Compaction.tsx
â”‚   â”‚   â”œâ”€â”€ ModelChange.tsx
â”‚   â”‚   â”œâ”€â”€ SessionHeader.tsx
â”‚   â”‚   â”œâ”€â”€ UserMessage.tsx
â”‚   â”‚   â”œâ”€â”€ AssistantMessage.tsx
â”‚   â”‚   â”œâ”€â”€ ThinkingBlock.tsx
â”‚   â”‚   â”œâ”€â”€ MarkdownContent.tsx
â”‚   â”‚   â”œâ”€â”€ CodeBlock.tsx
â”‚   â”‚   â”œâ”€â”€ ImageContent.tsx
â”‚   â”‚   â””â”€â”€ dashboard/ (13ä¸ªä»ªè¡¨ç›˜ç»„ä»¶)
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useKeyboardShortcuts.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ session.ts
â”‚   â”‚   â”œâ”€â”€ markdown.ts
â”‚   â”‚   â””â”€â”€ format.ts
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ session.css
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ types.ts
â”œâ”€â”€ src-tauri/src/
â”‚   â”œâ”€â”€ commands.rs
â”‚   â”œâ”€â”€ scanner.rs
â”‚   â”œâ”€â”€ search.rs
â”‚   â”œâ”€â”€ export.rs
â”‚   â”œâ”€â”€ stats.rs (å·²æ›´æ–°)
â”‚   â”œâ”€â”€ session_parser.rs (æ–°å¢)
â”‚   â”œâ”€â”€ tantivy_search.rs
â”‚   â”œâ”€â”€ cache.rs
â”‚   â””â”€â”€ lib.rs
â””â”€â”€ README.md
```

## å¼€å‘å‘½ä»¤

```bash
cd ~/Dev/AI/pi-session-manager

# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run tauri:dev

# æ„å»º
npm run tauri:build
```

## é”®ç›˜å¿«æ·é”®

- `Cmd/Ctrl + R` - åˆ·æ–°ä¼šè¯åˆ—è¡¨
- `Cmd/Ctrl + F` - èšç„¦æœç´¢æ¡†
- `Cmd/Ctrl + Shift + S` - æ‰“å¼€ç»Ÿè®¡ä»ªè¡¨ç›˜
- `Esc` - æ¸…é™¤é€‰æ‹©/å…³é—­å¯¹è¯æ¡†

## ä½¿ç”¨ç»Ÿè®¡ä»ªè¡¨ç›˜

1. **æ‰“å¼€æ–¹å¼**:
   - ç‚¹å‡»å·¦ä¾§è¾¹æ çš„æŸ±çŠ¶å›¾å›¾æ ‡ ğŸ“Š
   - æˆ–æŒ‰ `Cmd+Shift+S`

2. **æ ‡ç­¾é¡µè¯´æ˜**:
   - **Overview**: æ€»è§ˆç»Ÿè®¡ã€æ¶ˆæ¯åˆ†å¸ƒã€æ´»åŠ¨çƒ­åŠ›å›¾
   - **Activity**: å…¨å¹´çƒ­åŠ›å›¾ã€å‘¨å¯¹æ¯”ã€æ´»åŠ¨è¶‹åŠ¿
   - **Projects**: é¡¹ç›®åˆ†å¸ƒã€æ¨¡å‹ä½¿ç”¨æ’è¡Œ
   - **Time**: å°æ—¶/æ—¥/å‘¨æ´»åŠ¨åˆ†å¸ƒ
   - **Tokens**: Token ç”¨é‡ã€æˆæœ¬ç»Ÿè®¡ã€æŒ‰æ¨¡å‹åˆ†æ
   - **Productivity**: ç”Ÿäº§åŠ›æŒ‡æ ‡ã€è¿ç»­å¤©æ•°è¿½è¸ª
   - **Achievements**: æˆå°±ç³»ç»Ÿã€å¾½ç« æ”¶é›†

## æ•°æ®å‡†ç¡®æ€§

æ‰€æœ‰ç»Ÿè®¡æ•°æ®å‡ä»å®é™…ä¼šè¯ JSONL æ–‡ä»¶ä¸­è§£æï¼š
- âœ… è§£ææ¯ä¸ªä¼šè¯çš„ JSONL æ–‡ä»¶
- âœ… ç»Ÿè®¡çœŸå®çš„æ¶ˆæ¯æ•°é‡ï¼ˆæŒ‰è§’è‰²ï¼‰
- âœ… æå–æ¯ä¸ªæ¨¡å‹çš„ token ç”¨é‡
- âœ… è®¡ç®—å®é™…æˆæœ¬
- âœ… è¿½è¸ªæ´»åŠ¨æ—¶é—´æˆ³

## å‰©ä½™åŠŸèƒ½ (å¯é€‰)

1. Tantivy æœç´¢å¼•æ“å®Œæ•´å®ç°
2. ä¼šè¯åˆå¹¶åŠŸèƒ½
3. é«˜çº§ç­›é€‰ (æ—¥æœŸã€é¡¹ç›®ã€æ¨¡å‹)
4. æ–‡ä»¶ç³»ç»Ÿç›‘å¬å®æ—¶æ›´æ–°
5. æ‹–æ”¾æ–‡ä»¶å¤„ç†
6. å¤åˆ¶æ¶ˆæ¯åˆ°å‰ªè´´æ¿
7. æ‰“å°ä¼šè¯å¯¼å‡º
8. å¯¼å‡ºç»Ÿè®¡æ•°æ®ä¸º CSV/JSON

## ä¸‹ä¸€æ­¥

é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¯ä»¥ï¼š
1. âœ… æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. âœ… éªŒè¯ç»Ÿè®¡æ•°æ®å‡†ç¡®æ€§
3. ç»§ç»­å®ç°å‰©ä½™å¯é€‰åŠŸèƒ½
4. å‡†å¤‡å‘å¸ƒç‰ˆæœ¬

## æœ€è¿‘æ›´æ–° (2026-01-30)

### æ–°å¢åŠŸèƒ½
- é«˜çº§ç»Ÿè®¡ä»ªè¡¨ç›˜ï¼ˆ13ä¸ªç»„ä»¶ï¼‰
- çœŸå®æ¶ˆæ¯ç»Ÿè®¡ï¼ˆç”¨æˆ·/åŠ©æ‰‹ï¼‰
- Token ç”¨é‡è¿½è¸ª
- æ¨¡å‹ä½¿ç”¨åˆ†æ
- æˆæœ¬ç»Ÿè®¡
- æˆå°±ç³»ç»Ÿ
- æ´»åŠ¨çƒ­åŠ›å›¾
- æ—¶é—´åˆ†å¸ƒåˆ†æ

### ä¿®å¤é—®é¢˜
- ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯è¯†åˆ«ï¼ˆä»50%/50%å ä½ç¬¦æ”¹ä¸ºçœŸå®ç»Ÿè®¡ï¼‰
- æ¨¡å‹ token ç”¨é‡è¯†åˆ«
- ç»Ÿè®¡æ•°æ®å‡†ç¡®æ€§

### æŠ€æœ¯æ”¹è¿›
- æ–°å¢ `session_parser.rs` æ¨¡å—ç”¨äºè§£æä¼šè¯æ–‡ä»¶
- æ›´æ–° `stats.rs` ä»¥ä½¿ç”¨çœŸå®æ•°æ®
- æ–°å¢ `TokenDetails` å’Œ `ModelTokenStats` ç±»å‹
- æ·»åŠ  `tokens_by_model` æ˜ å°„