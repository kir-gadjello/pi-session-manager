# 工具调用显示优化

## 问题描述

用户反馈了以下问题：
1. 工具调用显示很丑，没有清晰的区分
2. 编辑（edit）和读取（read）工具调用没有显示对应的内容

## 解决方案

### 1. 重新设计工具调用样式

在 `src/index.css` 中添加了完整的工具调用样式系统：

#### 工具调用容器
```css
.tool-execution {
  margin: 12px 0;
  border-radius: 8px;
  border: 1px solid rgba(138, 190, 183, 0.2);
  overflow: hidden;
  background: rgba(0, 0, 0, 0.2);
}
```

#### 状态颜色
- **Success**: 绿色边框 `rgba(181, 189, 104, 0.3)`
- **Error**: 红色边框 `rgba(204, 102, 102, 0.3)`
- **Pending**: 蓝色边框 `rgba(138, 190, 183, 0.3)`

#### 工具头部
```css
.tool-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  background: rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid rgba(138, 190, 183, 0.15);
}
```

### 2. 改进各个工具组件

#### Bash Execution (⚡ Bash)
- 添加工具名称和图标
- 显示退出码（exit code）
- 显示取消状态
- 改进命令显示样式

#### Read Execution (📖 Read)
- 添加工具名称和图标
- 显示文件路径和行号范围
- 使用 CodeBlock 组件显示文件内容
- 支持展开/折叠长内容
- 显示图片（如果有）
- 添加"No output"提示

#### Write Execution (✍️ Write)
- 添加工具名称和图标
- 显示文件路径和行数
- 使用 CodeBlock 组件显示写入内容
- 支持展开/折叠长内容
- 显示成功消息

#### Edit Execution (✏️ Edit)
- 添加工具名称和图标
- 显示文件路径
- 显示 diff（差异）
- 支持展开/折叠长 diff
- 添加"No changes"提示

#### Generic Tool Call (🔧 Tool)
- 添加工具名称和图标
- 显示参数（Arguments）
- 显示输出（Output）
- 支持展开/折叠长内容

### 3. 统一的视觉设计

所有工具调用现在都有统一的结构：

```
┌─────────────────────────────────────────┐
│ [图标] 工具名称  文件路径  [元数据]    │ ← 头部
├─────────────────────────────────────────┤
│ 命令/参数                               │ ← 命令行（仅 Bash）
├─────────────────────────────────────────┤
│ 内容/输出                               │ ← 主要内容
│                                         │
│ ... 20 more lines                       │ ← 展开提示
└─────────────────────────────────────────┘
```

## 功能特性

### 1. 清晰的工具区分

每个工具都有独特的图标和名称：
- ⚡ **Bash** - 命令执行
- 📖 **Read** - 文件读取
- ✍️ **Write** - 文件写入
- ✏️ **Edit** - 文件编辑
- 🔧 **Tool** - 通用工具

### 2. 状态指示

通过边框颜色区分状态：
- 🟢 **Success** - 绿色边框
- 🔴 **Error** - 红色边框
- 🔵 **Pending** - 蓝色边框

### 3. 内容展开/折叠

- 超过 20 行的内容会自动折叠
- 点击"... X more lines"展开完整内容
- 展开后可以点击"Show less"折叠

### 4. 代码高亮

- Read 和 Write 工具使用 CodeBlock 组件
- 自动检测文件类型并应用语法高亮
- 支持复制按钮（继承自 CodeBlock）

### 5. 元数据显示

- Bash: 显示退出码和取消状态
- Write: 显示行数
- Read: 显示行号范围

## 视觉效果

### 修改前
```
bash
$ ls -la
[输出混在一起，没有清晰的结构]

read
/path/to/file.ts
[内容显示不清晰]
```

### 修改后
```
┌─────────────────────────────────────────┐
│ ⚡ Bash                      exit 0     │
├─────────────────────────────────────────┤
│ $ ls -la                                │
├─────────────────────────────────────────┤
│ total 48                                │
│ drwxr-xr-x  12 user  staff  384 Jan 31 │
│ ...                                     │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 📖 Read  src/components/App.tsx         │
├─────────────────────────────────────────┤
│ import React from 'react'               │
│ import { useState } from 'react'        │
│ ...                                     │
│ ... 50 more lines                       │
└─────────────────────────────────────────┘
```

## 修改的文件

1. **src/index.css** - 添加完整的工具调用样式
   - 工具容器样式
   - 工具头部样式
   - 工具命令样式
   - 工具输出样式
   - 展开提示样式

2. **src/components/BashExecution.tsx** - 改进 Bash 工具显示
   - 添加工具头部
   - 显示退出码和状态
   - 改进命令显示

3. **src/components/ReadExecution.tsx** - 改进 Read 工具显示
   - 添加工具头部
   - 使用 CodeBlock 显示内容
   - 支持展开/折叠
   - 添加"No output"提示

4. **src/components/WriteExecution.tsx** - 改进 Write 工具显示
   - 添加工具头部
   - 使用 CodeBlock 显示内容
   - 显示行数
   - 支持展开/折叠

5. **src/components/EditExecution.tsx** - 改进 Edit 工具显示
   - 添加工具头部
   - 改进 diff 显示
   - 支持展开/折叠
   - 添加"No changes"提示

6. **src/components/GenericToolCall.tsx** - 改进通用工具显示
   - 添加工具头部
   - 分离参数和输出显示
   - 支持展开/折叠

## 样式细节

### 颜色方案

- **工具名称**: `#8abeb7` (主题色)
- **文件路径**: `#d4d4d8` (浅灰色)
- **元数据**: `#6a6f85` (灰色)
- **命令**: `#b5bd68` (绿色)
- **输出**: `#d4d4d8` (浅灰色)
- **展开提示**: `#6a6f85` (灰色)

### 间距

- 工具容器外边距: `12px 0`
- 头部内边距: `10px 12px`
- 命令内边距: `10px 12px`
- 输出内边距: `12px`
- 展开提示内边距: `8px 12px`

### 边框

- 容器边框: `1px solid rgba(138, 190, 183, 0.2)`
- 头部底部边框: `1px solid rgba(138, 190, 183, 0.15)`
- 圆角: `8px`

## 测试建议

1. **基本功能测试**:
   - 测试 Bash 工具调用显示
   - 测试 Read 工具调用显示
   - 测试 Write 工具调用显示
   - 测试 Edit 工具调用显示
   - 测试通用工具调用显示

2. **状态测试**:
   - 测试成功状态（绿色边框）
   - 测试错误状态（红色边框）
   - 测试待处理状态（蓝色边框）

3. **展开/折叠测试**:
   - 测试短内容（不显示展开按钮）
   - 测试长内容（显示展开按钮）
   - 测试展开功能
   - 测试折叠功能

4. **内容显示测试**:
   - 测试文件内容显示（Read）
   - 测试 diff 显示（Edit）
   - 测试命令输出显示（Bash）
   - 测试参数显示（Generic）

5. **边界情况测试**:
   - 测试无输出的工具调用
   - 测试无参数的工具调用
   - 测试超长路径
   - 测试超长命令

## 未来改进

1. **交互功能**:
   - 支持点击文件路径打开文件
   - 支持点击命令复制命令
   - 支持点击输出复制输出

2. **过滤功能**:
   - 支持按工具类型过滤
   - 支持按状态过滤
   - 支持搜索工具调用

3. **性能优化**:
   - 虚拟滚动（大量工具调用）
   - 延迟加载内容
   - 缓存展开状态

4. **可视化增强**:
   - 添加工具调用时间线
   - 添加工具调用统计
   - 添加工具调用依赖关系图

5. **导出功能**:
   - 导出工具调用历史
   - 导出工具调用统计
   - 导出工具调用日志
