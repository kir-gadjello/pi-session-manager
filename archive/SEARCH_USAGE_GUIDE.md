# Session Viewer 搜索功能使用指南

## 快速开始

### 1. 打开搜索

按下快捷键打开搜索栏：
- **macOS**: `Cmd + F`
- **Windows/Linux**: `Ctrl + F`

搜索栏会出现在右上角：

```
┌─────────────────────────────────────────────────────┐
│  [搜索框]  [1/5]  [↑] [↓] [×]                      │
└─────────────────────────────────────────────────────┘
```

### 2. 输入搜索关键词

在搜索框中输入要搜索的关键词，例如 "error"：

```
┌─────────────────────────────────────────────────────┐
│  [error]  [1/5]  [↑] [↓] [×]                       │
└─────────────────────────────────────────────────────┘
```

搜索结果会自动更新，所有匹配的关键词会被高亮显示。

### 3. 导航搜索结果

使用以下方式在搜索结果之间导航：

- **下一个结果**: 
  - 点击 `↓` 按钮
  - 或按 `Enter` 键

- **上一个结果**: 
  - 点击 `↑` 按钮
  - 或按 `Shift + Enter` 键

当前选中的结果会用更深的颜色高亮，并自动滚动到视口中央。

### 4. 关闭搜索

使用以下方式关闭搜索：

- 点击 `×` 按钮
- 或按 `Esc` 键

搜索栏会消失，所有高亮会被清除。

## 搜索示例

### 示例 1: 搜索错误信息

假设你想查找会话中所有提到 "error" 的消息：

1. 按 `Cmd+F` 打开搜索
2. 输入 "error"
3. 使用 `Enter` 或 `↓` 按钮浏览所有结果

### 示例 2: 搜索特定函数名

假设你想查找会话中讨论的某个函数 "handleClick"：

1. 按 `Cmd+F` 打开搜索
2. 输入 "handleClick"
3. 查看所有提到该函数的消息

### 示例 3: 搜索代码片段

假设你想查找包含 "useState" 的消息：

1. 按 `Cmd+F` 打开搜索
2. 输入 "useState"
3. 浏览所有相关的代码讨论

## 高亮效果

搜索功能会在消息中高亮显示匹配的关键词：

```
用户消息:
我遇到了一个 [error] 问题...
         ^^^^^^^^
         黄色高亮

助手消息:
这个 [error] 是因为...
     ^^^^^^^^
     黄色高亮（当前选中时为橙色）
```

## 搜索特性

### ✅ 支持的功能

- ✅ 大小写不敏感搜索
- ✅ 实时搜索（输入时自动更新）
- ✅ 全文搜索（用户消息 + 助手消息）
- ✅ 结果计数（显示 1/5）
- ✅ 自动滚动到结果
- ✅ 高亮显示匹配关键词
- ✅ 快捷键支持
- ✅ 循环导航（最后一个结果后回到第一个）

### ❌ 暂不支持的功能

- ❌ 正则表达式搜索
- ❌ 大小写敏感选项
- ❌ 全词匹配选项
- ❌ 搜索历史记录
- ❌ 在工具调用结果中搜索

## 快捷键总览

| 快捷键 | 功能 |
|--------|------|
| `Cmd+F` / `Ctrl+F` | 打开搜索 |
| `Enter` | 下一个结果 |
| `Shift+Enter` | 上一个结果 |
| `Esc` | 关闭搜索 |

## 常见问题

### Q: 为什么搜索不到我想要的内容？

A: 请检查：
1. 关键词拼写是否正确
2. 是否在正确的会话中搜索
3. 搜索是大小写不敏感的，但需要完全匹配

### Q: 如何搜索特殊字符？

A: 特殊字符（如 `*`, `+`, `?` 等）会被自动转义，可以直接搜索。

### Q: 搜索结果太多怎么办？

A: 尝试使用更具体的关键词，或者使用更长的短语来缩小搜索范围。

### Q: 可以同时搜索多个关键词吗？

A: 目前不支持多关键词搜索，但可以搜索包含空格的短语。

## 技术细节

### 搜索范围

搜索功能会在以下内容中查找关键词：

- ✅ 用户消息的文本内容
- ✅ 助手消息的文本内容
- ❌ 工具调用的参数和结果（暂不支持）
- ❌ 思考块内容（暂不支持）
- ❌ 图片内容（暂不支持）

### 高亮实现

搜索高亮使用 HTML `<mark>` 标签实现：

```html
<mark class="search-highlight">关键词</mark>
```

当前选中的结果会添加额外的 class：

```html
<mark class="search-highlight current">关键词</mark>
```

### 性能考虑

- 搜索在前端执行，不会发送到服务器
- 大量消息时可能会有轻微延迟
- 搜索结果会被缓存，重复搜索相同关键词会更快

## 反馈与改进

如果你在使用搜索功能时遇到问题或有改进建议，请：

1. 查看详细文档: `SEARCH_FEATURE.md`
2. 运行测试脚本: `./test-search.sh`
3. 提交 Issue 或 Pull Request

## 相关文档

- [SEARCH_FEATURE.md](SEARCH_FEATURE.md) - 完整的技术文档
- [test-search.sh](test-search.sh) - 功能测试脚本
